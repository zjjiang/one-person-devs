{% extends "base.html" %}
{% block title %}OPD - 创建 Story{% endblock %}
{% block content %}
<div class="page-header">
  <h1>创建 Story</h1>
  <span class="page-subtitle">项目: {{ project.name }}</span>
</div>

<form id="story-form" class="form">
  <div class="form-group">
    <label for="title">标题</label>
    <input type="text" id="title" name="title" required placeholder="简要描述需求">
  </div>
  <div class="form-group">
    <label for="raw_input">需求描述</label>
    <textarea id="raw_input" name="raw_input" rows="8" required
              placeholder="详细描述你的需求..."></textarea>
  </div>
  <div class="form-group">
    <label for="feature_tag">Feature 标签 (可选)</label>
    <input type="text" id="feature_tag" name="feature_tag" placeholder="例如: auth, payment">
  </div>
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">创建</button>
    <a href="/projects/{{ project.id }}" class="btn btn-secondary">取消</a>
  </div>
</form>

<script>
document.getElementById('story-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const data = {
    title: document.getElementById('title').value,
    raw_input: document.getElementById('raw_input').value,
    feature_tag: document.getElementById('feature_tag').value || null,
  };
  const res = await fetch('/api/projects/{{ project.id }}/stories', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data),
  });
  const result = await res.json();
  if (result.id) {
    window.location.href = '/stories/' + result.id;
  }
});
</script>
{% endblock %}
